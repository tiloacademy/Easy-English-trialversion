<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>H·ªçc Ti·∫øng Anh</title>
    <style>
        /* --- 1. C·∫§U H√åNH C·ªê ƒê·ªäNH --- */
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        
        body { 
            font-family: sans-serif; 
            background-color: #fdf2e9; 
            margin: 0; padding: 0; 
            height: 100vh; width: 100vw; 
            overflow: hidden; /* Ch·∫∑n cu·ªôn tuy·ªát ƒë·ªëi */
        }

        /* --- 2. M√ÄN H√åNH H·ªåC (LEARNING) --- */
        #learning-screen {
            width: 100%; height: 100%;
            display: flex; flex-direction: column;
            padding: 10px; background: #fff;
            position: absolute; top: 0; left: 0; z-index: 10;
        }

        .header-title { 
            height: 40px; text-align: center; color: #ff6f00; font-size: 20px; font-weight: bold; margin: 0; 
            display: flex; align-items: center; justify-content: center; flex-shrink: 0;
        }

        /* KHUNG ·∫¢NH: S·ª≠ d·ª•ng flex: 1 v√† min-height: 0 ƒë·ªÉ tr√°nh l·ªói m·∫•t h√¨nh */
        .learn-img-wrapper {
            flex: 1; /* T·ª± gi√£n h·∫øt c·ª° trong kho·∫£ng tr·ªëng */
            min-height: 0; /* Quan tr·ªçng: NgƒÉn flex item b·ªã v·ª° layout */
            width: 100%;
            display: flex; align-items: center; justify-content: center;
            background: #fff8e1; border-radius: 15px; border: 2px dashed #ffcc80;
            margin: 5px 0; padding: 10px;
        }
        
        #learn-img {
            max-width: 100%; max-height: 100%; 
            object-fit: contain; /* ·∫¢nh lu√¥n n·∫±m tr·ªçn trong khung */
            display: block;
        }

        /* TH√îNG TIN CH·ªÆ: C·ªë ƒë·ªãnh chi·ªÅu cao */
        .word-info { 
            height: 120px; flex-shrink: 0;
            display: flex; flex-direction: column; 
            align-items: center; justify-content: center; 
        }
        .word-display { font-size: 36px; font-weight: 900; color: #333; margin: 0; }
        .phonetic { font-size: 20px; color: #666; font-family: serif; margin-top: 5px; }

        /* C√¢u v√≠ d·ª• */
        .sentence-box { display: none; flex-wrap: wrap; justify-content: center; gap: 5px; }
        .s-chunk { text-align: center; }
        .s-ipa { font-size: 14px; color: #e67e22; }
        .s-txt { font-size: 20px; font-weight: bold; }

        /* KHU V·ª∞C N√öT B·∫§M */
        .controls-area { 
            height: 130px; flex-shrink: 0;
            display: flex; flex-direction: column; justify-content: flex-end; 
        }
        
        .btn-large {
            width: 100%; padding: 12px; border-radius: 50px; border: none;
            font-size: 20px; font-weight: bold; color: white; cursor: pointer;
            box-shadow: 0 4px #bbb; margin-bottom: 10px;
        }
        .btn-mic { background: #27ae60; }
        .btn-game-entry { background: #9b59b6; animation: pulse 1s infinite; }
        @keyframes pulse { 0% {transform: scale(1);} 50% {transform: scale(1.02);} 100% {transform: scale(1);} }
        
        .nav-bar { display: flex; justify-content: space-between; align-items: center; height: 60px; }
        .btn-nav { width: 50px; height: 50px; border-radius: 50%; background: #f39c12; color: white; border: none; font-size: 24px; font-weight: bold; }
        .btn-replay { background: white; color: #2980b9; border: 2px solid #2980b9; padding: 10px 30px; border-radius: 20px; font-weight: bold; cursor: pointer; font-size: 16px; }

        /* --- 3. M√ÄN H√åNH GAME (FULLSCREEN) --- */
        #game-screen {
            display: none; /* ·∫®n m·∫∑c ƒë·ªãnh */
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: #fff3e0; z-index: 20;
            /* D√πng Grid ƒë·ªÉ chia layout c·ª©ng */
            display: grid;
            grid-template-rows: 60px 1fr 80px; /* Header - Body - Footer */
        }

        /* 1. Header Game */
        .game-header {
            display: flex; justify-content: center; align-items: center;
            position: relative; background: rgba(255,255,255,0.8);
            border-bottom: 1px solid #ccc;
        }
        .timer-badge {
            background: white; border: 3px solid #d35400; color: #d35400;
            padding: 5px 20px; border-radius: 20px; font-size: 24px; font-weight: bold;
        }
        .btn-close {
            position: absolute; right: 10px; background: #c0392b; color: white;
            width: 40px; height: 40px; border-radius: 50%; border: none; font-weight: bold; font-size: 20px;
        }

        /* 2. Th√°p Th·∫ª (Body) */
        .tower-container {
            width: 100%; height: 100%; /* Chi·∫øm to√†n b·ªô ph·∫ßn gi·ªØa (1fr) */
            display: flex; flex-direction: column;
            padding: 5px 0;
        }

        .tower-row {
            flex: 1; /* Chia ƒë·ªÅu chi·ªÅu cao cho 4 h√†ng (25% m·ªói h√†ng) */
            width: 100%;
            display: flex; justify-content: center; align-items: center;
            gap: 15px; /* Kho·∫£ng c√°ch ngang gi·ªØa c√°c th·∫ª */
            border-bottom: 1px dashed rgba(0,0,0,0.05);
        }

        /* TH·∫∫ B√ÄI: T·ª± ƒë·ªông to theo chi·ªÅu cao c·ªßa h√†ng */
        .card-flip {
            height: 90%; /* Chi·∫øm 90% chi·ªÅu cao c·ªßa h√†ng -> R·∫•t to */
            aspect-ratio: 0.75; /* T·ª∑ l·ªá v√†ng cho th·∫ª (3:4) */
            position: relative; perspective: 1000px;
        }
        
        .card-inner {
            position: relative; width: 100%; height: 100%;
            transition: transform 0.4s; transform-style: preserve-3d;
            border-radius: 12px; box-shadow: 0 4px 5px rgba(0,0,0,0.3);
        }
        .card-flip.flipped .card-inner { transform: rotateY(180deg); }
        .card-flip.matched .card-inner { opacity: 0; pointer-events: none; }

        .face {
            position: absolute; width: 100%; height: 100%;
            backface-visibility: hidden; border-radius: 12px;
            display: flex; align-items: center; justify-content: center;
            border: 2px solid #5d4037;
        }
        
        /* M·∫∑t √öp: N√¢u + S·ªë To */
        .front { 
            background: #8d6e63; color: #3e2723; 
            font-size: 5vh; /* Ch·ªØ to theo m√†n h√¨nh */
            font-weight: 900;
        }
        
        /* M·∫∑t Ng·ª≠a: ·∫¢nh */
        .back { background: white; transform: rotateY(180deg); padding: 5px; }
        .back img { width: 95%; height: 95%; object-fit: contain; }

        /* 3. Footer Game */
        .game-footer {
            display: flex; justify-content: space-around; align-items: center;
            background: white; border-top: 1px solid #ccc;
        }
        .btn-ctrl {
            padding: 10px 0; border-radius: 30px; border: none; color: white;
            font-size: 18px; font-weight: bold; cursor: pointer;
            box-shadow: 0 3px #999; width: 40%;
            display: flex; justify-content: center; align-items: center; gap: 10px;
        }

        /* Modal Chi·∫øn Th·∫Øng */
        #win-modal {
            display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(255,255,255,0.95); z-index: 50;
            flex-direction: column; align-items: center; justify-content: center;
        }
    </style>
</head>
<body>

<div id="learning-screen">
    <div class="header-title">üêª B√© H·ªçc Ti·∫øng Anh üê∞</div>
    
    <div class="learn-img-wrapper">
        <img id="learn-img" src="" alt="Learning Image">
    </div>

    <div class="word-info">
        <div id="mode-word">
            <h2 class="word-display" id="disp-text">...</h2>
            <div class="phonetic" id="disp-ipa">...</div>
        </div>
        <div id="mode-sent" class="sentence-box"></div>
    </div>

    <div class="controls-area">
        <div id="action-btn-container">
            <button class="btn-large btn-mic">üé§ ƒê·ªçc Ngay</button>
        </div>
        <div class="nav-bar">
            <button class="btn-nav" onclick="nav(-1)">‚óÄ</button>
            <button class="btn-replay" id="btn-audio" onclick="playAudio()">üîä Nghe l·∫°i</button>
            <button class="btn-nav" onclick="nav(1)">‚ñ∂</button>
        </div>
    </div>
</div>

<div id="game-screen">
    <div class="game-header">
        <div class="timer-badge">‚è±Ô∏è <span id="timer">00:00</span></div>
        <button class="btn-close" onclick="exitGame()">‚úï</button>
    </div>

    <div id="tower" class="tower-container"></div>

    <div class="game-footer">
        <button class="btn-ctrl" style="background:#27ae60" onclick="playLastCard()">üîä Nghe</button>
        <button class="btn-ctrl" style="background:#e67e22" onclick="initGame()">‚Üª Ch∆°i l·∫°i</button>
    </div>

    <div id="win-modal">
        <h1 style="color:green; font-size:40px;">XU·∫§T S·∫ÆC! üéâ</h1>
        <p id="win-time" style="font-size:24px; color:#555;">00:00</p>
        <br>
        <button class="btn-ctrl" style="background:#e67e22; width: auto; padding: 10px 40px;" onclick="initGame()">Ch∆°i l·∫°i</button>
        <br>
        <button class="btn-large" style="background:#2980b9; width:auto; padding:10px 40px;" onclick="exitGame()">B√†i Ti·∫øp ‚û°</button>
    </div>
</div>

<script>
    // --- D·ªÆ LI·ªÜU ---
    // T√¥i s·ª≠ d·ª•ng link ·∫£nh placeholder C√ì CH·ªÆ T√äN H√åNH ƒë·ªÉ ƒë·∫£m b·∫£o b·∫°n nh√¨n th·∫•y n√≥ ho·∫°t ƒë·ªông
    // Sau khi test xong, b·∫°n thay l·∫°i t√™n file c·ªßa b·∫°n (v√≠ d·ª•: 'beer.png')
    const data = [
        // T·ª´ v·ª±ng
        { type: 'word', text: 'Beer', ipa: '/b…™…ôr/', speak: 'beer', img: 'https://placehold.co/400x400/png?text=BEER' },
        { type: 'word', text: 'Deer', ipa: '/d…™…ôr/', speak: 'deer', img: 'https://placehold.co/400x400/png?text=DEER' },
        { type: 'word', text: 'Ear', ipa: '/…™…ôr/', speak: 'ear', img: 'https://placehold.co/400x400/png?text=EAR' },
        { type: 'word', text: 'Tear', ipa: '/t…™…ôr/', speak: 'tier', img: 'https://placehold.co/400x400/png?text=TEAR' },

        // GAME (5 C·∫∑p h√¨nh)
        { 
            type: 'game', title: 'Tr√≤ Ch∆°i',
            pairs: [
                { id: 'beer', img: 'https://placehold.co/300x300/orange/white?text=BEER' },
                { id: 'deer', img: 'https://placehold.co/300x300/green/white?text=DEER' },
                { id: 'ear',  img: 'https://placehold.co/300x300/blue/white?text=EAR' },
                { id: 'tear', img: 'https://placehold.co/300x300/red/white?text=TEAR' },
                { id: 'bear', img: 'https://placehold.co/300x300/purple/white?text=BEAR' } 
            ]
        },

        // C√¢u
        { type: 'sent', text: 'The deer is near the chair', img: 'https://placehold.co/600x400/png?text=Sentence+Deer',
          parts: [{t:'The',p:'√∞…ô'},{t:'deer',p:'…™r'},{t:'is',p:'…™z'},{t:'near',p:'…™r'},{t:'the',p:'√∞…ô'},{t:'chair',p:'t É…õr'}] 
        }
    ];

    let idx = 0;
    // Game vars
    let timerInt, sec=0, flipped=false, lock=false, c1, c2, match=0, lastWord="";

    // KH·ªûI ƒê·ªòNG
    window.onload = () => render(0);

    function render(i) {
        if(i < 0 || i >= data.length) return;
        idx = i;
        const item = data[i];

        // Chuy·ªÉn ƒë·ªïi m√†n h√¨nh (S·ª≠ d·ª•ng display grid cho game ƒë·ªÉ fix c·ª©ng layout)
        document.getElementById('game-screen').style.display = 'none';
        document.getElementById('learning-screen').style.display = 'flex';
        document.getElementById('win-modal').style.display = 'none';

        const imgEl = document.getElementById('learn-img');
        const btnArea = document.getElementById('action-btn-container');
        const replayBtn = document.getElementById('btn-audio');

        if(item.type === 'game') {
            // M√†n h√¨nh ch·ªù Game
            imgEl.src = 'https://placehold.co/400x400/png?text=GAME+TIME';
            document.getElementById('disp-text').innerText = "Gi·ªù Ch∆°i!";
            document.getElementById('disp-ipa').innerText = "";
            document.getElementById('mode-sent').style.display = 'none';
            document.getElementById('mode-word').style.display = 'block';
            replayBtn.style.visibility = 'hidden';

            btnArea.innerHTML = `<button class="btn-large btn-game-entry" onclick="startGame()">üöÄ B·∫Øt ƒê·∫ßu Ch∆°i</button>`;
        } else {
            // M√†n h√¨nh H·ªçc
            imgEl.src = item.img;
            replayBtn.style.visibility = 'visible';
            btnArea.innerHTML = `<button class="btn-large btn-mic" onclick="alert('B√© ƒë·ªçc t·ªët l·∫Øm!')">üé§ ƒê·ªçc Ngay</button>`;

            if(item.type === 'sent') {
                document.getElementById('mode-word').style.display = 'none';
                const box = document.getElementById('mode-sent');
                box.style.display = 'flex'; box.innerHTML = '';
                item.parts.forEach(p => {
                    box.innerHTML += `<div class="s-chunk"><div class="s-ipa">${p.p}</div><div class="s-txt">${p.t}</div></div>`;
                });
            } else {
                document.getElementById('mode-word').style.display = 'block';
                document.getElementById('mode-sent').style.display = 'none';
                document.getElementById('disp-text').innerText = item.text;
                document.getElementById('disp-ipa').innerText = item.ipa;
            }
            setTimeout(playAudio, 500);
        }
    }

    function nav(d) { render(idx + d); }
    
    function playAudio() {
        const item = data[idx];
        if(item.type !== 'game') speak(item.speak || item.text);
    }

    function speak(txt) {
        window.speechSynthesis.cancel();
        const u = new SpeechSynthesisUtterance(txt);
        u.lang = 'en-US';
        window.speechSynthesis.speak(u);
    }

    // --- LOGIC GAME 3-2-3-2 ---
    function startGame() {
        document.getElementById('learning-screen').style.display = 'none';
        // S·ª≠ d·ª•ng Grid cho Game Screen
        document.getElementById('game-screen').style.display = 'grid'; 
        initGame();
    }

    function initGame() {
        const item = data[idx];
        const tower = document.getElementById('tower');
        tower.innerHTML = '';
        document.getElementById('win-modal').style.display = 'none';

        clearInterval(timerInt);
        sec=0; document.getElementById('timer').innerText = "00:00";
        startTimer();

        flipped=false; lock=false; c1=null; c2=null; match=0; lastWord="Choose";

        // T·∫°o th·∫ª
        let cards = [];
        item.pairs.forEach(p => {
            cards.push({id:p.id, img:p.img});
            cards.push({id:p.id, img:p.img});
        });
        cards.sort(() => 0.5 - Math.random());

        // B·ªë c·ª•c 3-2-3-2
        const rows = [3, 2, 3, 2];
        let cCount = 0;
        let num = 1;

        rows.forEach(cnt => {
            const rowDiv = document.createElement('div');
            rowDiv.className = 'tower-row';

            for(let k=0; k<cnt; k++) {
                const c = cards[cCount];
                const el = document.createElement('div');
                el.className = 'card-flip';
                el.dataset.id = c.id;
                el.innerHTML = `
                    <div class="card-inner">
                        <div class="face front">${num}</div>
                        <div class="face back"><img src="${c.img}"></div>
                    </div>
                `;
                el.onclick = function() { cardClick(this); };
                rowDiv.appendChild(el);
                cCount++; num++;
            }
            tower.appendChild(rowDiv);
        });
    }

    function cardClick(el) {
        if(lock || el===c1 || el.classList.contains('matched')) return;
        el.classList.add('flipped');
        lastWord = el.dataset.id;
        speak(lastWord);

        if(!flipped) {
            flipped=true; c1=el;
        } else {
            c2=el; check();
        }
    }

    function check() {
        lock=true;
        if(c1.dataset.id === c2.dataset.id) {
            setTimeout(() => {
                c1.classList.add('matched'); c2.classList.add('matched');
                match++; reset();
                if(match===5) win();
            }, 500);
        } else {
            setTimeout(() => {
                c1.classList.remove('flipped'); c2.classList.remove('flipped');
                reset();
            }, 1000);
        }
    }

    function reset() { flipped=false; lock=false; c1=null; c2=null; }
    
    function startTimer() {
        timerInt = setInterval(() => {
            sec++;
            let m=Math.floor(sec/60).toString().padStart(2,'0');
            let s=(sec%60).toString().padStart(2,'0');
            document.getElementById('timer').innerText = `${m}:${s}`;
        }, 1000);
    }

    function win() {
        clearInterval(timerInt);
        document.getElementById('win-time').innerText = document.getElementById('timer').innerText;
        document.getElementById('win-modal').style.display = 'flex';
        speak("Excellent job!");
    }

    function playLastCard() { speak(lastWord); }
    function exitGame() { clearInterval(timerInt); nav(-1); }

</script>
</body>
</html>
